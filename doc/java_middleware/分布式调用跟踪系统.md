对于大型网站以及各种微服务框架的兴起，一个网站系统内部互相之间的调用变得越来越复杂，迫切需要一个可以监控调用链路的机制，用于性能优化以及故障排除。
Google不愧时计算机互联网的老大，大部分分布式调用跟踪系统都是基于google的dapper，包括twitter的zipkin以及淘宝的鹰眼。
几个关键问题：

1、调用结构分析：
每一个程序的执行结构，展开后都是一个树状结构，执行的入口可以看作根结点。这个调用结构就形成了跟踪系统的跟踪树。

2、如何记录整个调用过程：
基本生产环境都可以采用基于标注的解决方案，就是在每个调用中进行标记。
这个方案需要在整个调用系统中植入标记的代码。但是生产环境中，各个系统的调用一般都采用相同的线程模型、rpc架构，所以代码只需要植入到关键的组件中即可。譬如，鹰眼就可以将代码植入到pandora中，每次发起hsf调用时，每次接受hsf调用时，都会记录调用信息，传递调用信息。

3、对于并发系统如何记录某个调用过程：
在程序中标记某个任务执行的东西就是线程。先只考虑同步的场景，一个线程的整个生命周期就代表了整个调用的过程。不同的语言对线程模型不同，以java为例子，标记代码会将调用信息保存在threadlocal中。另外由于涉及到多个集群，当发起rpc调用时，公共组件会将调用方线程标记信息（譬如traceid）传递个下一个集群的线程中，下一个线程会在此基础上添加自己的调用信息。

4、性能问题
植入代码后，在正常调用逻辑中添加了新的标记逻辑，势必会影响之前的性能，但是可以通过控制采样率，譬如没几次调用记录一次，可以减少很多标记的开销。
